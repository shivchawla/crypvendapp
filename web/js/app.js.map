{"version":3,"sources":["../src/app.js"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["/* globals $, URLSearchParams, WebSocket, locales, Keyboard, Keypad, Jed, BigNumber, HOST, PORT, Origami, kjua, TimelineMax, Two */\r\n'use strict'\r\n\r\nconst queryString = window.location.search\r\nconst params = new URLSearchParams(queryString.substring(1))\r\nconst SCREEN = params.get('screen')\r\nconst DEBUG_MODE = SCREEN ? 'demo' : params.get('debug')\r\nconst CASH_OUT_QR_COLOR = '#403c51'\r\nconst CASH_IN_QR_COLOR = '#0e4160'\r\n\r\nvar scrollSize = 0\r\nvar textHeightQuantity = 0\r\nvar currentPage = 0\r\nvar totalPages = 0\r\nvar aspectRatio = '16:10'\r\nvar isTwoWay = null\r\nvar isRTL = false\r\nvar two = null\r\nvar cryptomatModel = null\r\nvar termsConditionsTimeout = null\r\nvar T_C_TIMEOUT = 30000\r\n\r\nvar fiatCode = null\r\nvar locale = null\r\nvar localeCode = null\r\nvar jsLocaleCode = null // Sometimes slightly different than localeCode\r\nvar _primaryLocales = []\r\nvar lastRates = null\r\nvar coins = {\r\n  BTC: {\r\n    unitScale: 8,\r\n    displayScale: 5,\r\n    displayCode: 'mBTC'\r\n  },\r\n  ETH: {\r\n    unitScale: 18,\r\n    displayScale: 15,\r\n    displayCode: 'mETH'\r\n  },\r\n  ZEC: {\r\n    unitScale: 8,\r\n    displayScale: 5,\r\n    displayCode: 'mZEC'\r\n  },\r\n  LTC: {\r\n    unitScale: 8,\r\n    displayScale: 5,\r\n    displayCode: 'mLTC'\r\n  },\r\n  DASH: {\r\n    unitScale: 8,\r\n    displayScale: 5,\r\n    displayCode: 'mDASH'\r\n  },\r\n  BCH: {\r\n    unitScale: 8,\r\n    displayScale: 5,\r\n    displayCode: 'mBCH'\r\n  }\r\n}\r\n\r\nvar currentState\r\n\r\nvar accepting = false\r\nvar websocket = null\r\nvar wifiKeyboard = null\r\nvar promoKeyboard = null\r\nvar usSsnKeypad = null\r\nvar phoneKeypad = null\r\nvar securityKeypad = null\r\nvar previousState = null\r\nvar buttonActive = true\r\nvar cassettes = null\r\nlet currentCryptoCode = null\r\nlet currentCoin = null\r\nlet currentCoins = []\r\n\r\nvar MUSEO = ['ca', 'cs', 'da', 'de', 'en', 'es', 'et', 'fi', 'fr', 'hr',\r\n  'hu', 'it', 'lt', 'nb', 'nl', 'pl', 'pt', 'ro', 'sl', 'sv', 'tr']\r\n\r\n// function connect () {\r\n//   console.log(`ws://${HOST}:${PORT}/`)\r\n//   websocket = new WebSocket(`ws://${HOST}:${PORT}/`)\r\n//   websocket.onmessage = function (event) {\r\n//     var data = $.parseJSON(event.data)\r\n//     processData(data)\r\n//   }\r\n//   websocket.onerror = err => console.log(err)\r\n// }\r\n\r\n// function verifyConnection () {\r\n//   if (websocket.readyState === websocket.CLOSED) {\r\n//     connect()\r\n//   }\r\n// }\r\n\r\n\r\nfunction setupWebview() {\r\n    console.log(\"App.js Loaded\");\r\n    window.addEventListener('message', (event) => {\r\n        console.log(\"In Browser\");\r\n        console.log(event);\r\n        processData(event.data);\r\n        console.log(\"Printing document\");\r\n        console.log(document);\r\n    });\r\n}\r\n\r\n\r\nfunction buttonPressed (button, data) {\r\n  console.log(\"Button Pressed in Browser\");\r\n  console.log(button);\r\n  console.log(data);\r\n\r\n  try {\r\n  if (!buttonActive) return\r\n  // wifiKeyboard.deactivate()\r\n  promoKeyboard.deactivate()\r\n  buttonActive = false\r\n  setTimeout(function () {\r\n    buttonActive = true\r\n    // wifiKeyboard.activate()\r\n    promoKeyboard.activate()\r\n  }, 300)\r\n  var res = {button: button}\r\n  if (data || data === null) res.data = data\r\n  // if (websocket) websocket.send(JSON.stringify(res))\r\n  console.log(res);\r\n  console.log(\"Posting Message\");\r\n  window.ReactNativeWebView.postMessage(JSON.stringify(res));\r\n\r\n  } catch(err) {\r\n    console.log(err);\r\n  } \r\n}\r\n\r\n\r\nfunction processData (data) {\r\n  console.log(\"In Process Data\");\r\n  console.log(data);\r\n  if (data.localeInfo) setLocaleInfo(data.localeInfo)\r\n  if (data.locale) setLocale(data.locale)\r\n  if (!locale) return\r\n  if (data.fiatCode) setFiatCode(data.fiatCode)\r\n  if (data.rates) setExchangeRate(data.rates)\r\n  if (data.buyerAddress) setBuyerAddress(data.buyerAddress)\r\n  if (data.credit) {\r\n    var lastBill = data.action === 'rejectedBill' ? null : data.credit.lastBill\r\n    setCredit(data.credit.fiat, data.credit.cryptoAtoms, lastBill, data.credit.cryptoCode)\r\n  }\r\n  if (data.tx) setTx(data.tx)\r\n  if (data.wifiList) setWifiList(data.wifiList)\r\n  if (data.wifiSsid) setWifiSsid(data.wifiSsid)\r\n  if (data.sendOnly) sendOnly(data.reason)\r\n  if (data.fiatCredit) fiatCredit(data.fiatCredit)\r\n  if (data.depositInfo) setDepositAddress(data.depositInfo)\r\n  if (data.version) setVersion(data.version)\r\n  if (data.cassettes) setupCassettes(data.cassettes)\r\n  if (data.sent && data.total) setPartialSend(data.sent, data.total)\r\n  if (data.readingBill) readingBill(data.readingBill)\r\n  if (data.cryptoCode) translateCoin(data.cryptoCode)\r\n  if (data.tx && data.tx.cashInFee) setFixedFee(data.tx.cashInFee)\r\n  if (data.terms) setTermsScreen(data.terms)\r\n  if (data.dispenseBatch) dispenseBatch(data.dispenseBatch)\r\n  if (data.direction) setDirection(data.direction)\r\n  if (data.operatorInfo) setOperatorInfo(data.operatorInfo)\r\n  if (data.hardLimit) setHardLimit(data.hardLimit)\r\n  if (data.cryptomatModel) setCryptomatModel(data.cryptomatModel)\r\n  if (data.areThereAvailablePromoCodes !== undefined) setAvailablePromoCodes(data.areThereAvailablePromoCodes)\r\n  if (data.tx && data.tx.discount) setCurrentDiscount(data.tx.discount)\r\n\r\n  if (data.context) {\r\n    $('.js-context').hide()\r\n    $('.js-context-' + data.context).show()\r\n  }\r\n\r\n  console.log(data);\r\n  return;\r\n\r\n  switch (data.action) {\r\n    case 'wifiList':\r\n      if (cryptomatModel === 'douro1') {\r\n        setState('wifi')\r\n      } else {\r\n        setState('connect_ethernet')\r\n      }\r\n      break\r\n    case 'wifiPass':\r\n      setState('wifi_password')\r\n      break\r\n    case 'wifiConnecting':\r\n      t('wifi-connecting',\r\n        locale.translate('This could take a few moments.').fetch())\r\n      setState('wifi_connecting')\r\n      break\r\n    case 'wifiConnected':\r\n      t('wifi-connecting',\r\n        locale.translate('Connected. Waiting for ticker.').fetch())\r\n      setState('wifi_connecting') // in case we didn't go through wifi-connecting\r\n      break\r\n    case 'pairing':\r\n      setState('pairing')\r\n      break\r\n    case 'pairingError':\r\n      $('.js-pairing-error').text(data.err)\r\n      // Give it some time to update text in background\r\n      setTimeout(function () { setState('pairing_error') }, 500)\r\n      break\r\n    case 'booting':\r\n      if (currentState !== 'maintenance') setState('booting')\r\n      break\r\n    case 'idle':\r\n    case 'fakeIdle':\r\n      setState('idle')\r\n      break\r\n    case 'dualIdle':\r\n    case 'fakeDualIdle':\r\n      setState('dual_idle')\r\n      break\r\n    case 'registerUsSsn':\r\n      usSsnKeypad.activate()\r\n      setState('register_us_ssn')\r\n      break\r\n    case 'registerPhone':\r\n      phoneKeypad.activate()\r\n      setState('register_phone')\r\n      break\r\n    case 'securityCode':\r\n      securityKeypad.activate()\r\n      setState('security_code')\r\n      break\r\n    case 'scanned':\r\n      setState('insert_bills')\r\n      break\r\n    case 'acceptingFirstBill':\r\n      $('.js-send-crypto-disable').hide()\r\n      $('.js-send-crypto-enable').show()\r\n      setState('insert_bills')\r\n      break\r\n    case 'acceptingBills':\r\n      $('.blocked-customer-top').hide()\r\n      setState('insert_more_bills')\r\n      break\r\n    case 'acceptingBill':\r\n      setAccepting(true)\r\n      break\r\n    case 'rejectedBill':\r\n      setAccepting(false)\r\n      break\r\n    case 'cryptoTransferPending':\r\n      setState('sending_coins')\r\n      break\r\n    case 'cryptoTransferComplete':\r\n      setState('completed')\r\n      break\r\n    case 'networkDown':\r\n      setState('trouble')\r\n      break\r\n    case 'balanceLow':\r\n    case 'insufficientFunds':\r\n      setState('limit_reached')\r\n      break\r\n    case 'highBill':\r\n      highBill(data.highestBill, data.reason)\r\n      break\r\n    case 'minimumTx':\r\n      minimumTx(data.lowestBill)\r\n      break\r\n    case 'chooseFiat':\r\n      chooseFiat(data.chooseFiat)\r\n      break\r\n    case 'deposit':\r\n      setState('deposit')\r\n      deposit(data.tx)\r\n      break\r\n    case 'rejectedDeposit':\r\n      setState('deposit_timeout')\r\n      break\r\n    case 'fiatReceipt':\r\n      fiatReceipt(data.tx)\r\n      break\r\n    case 'fiatComplete':\r\n      fiatComplete(data.tx)\r\n      break\r\n    case 'restart':\r\n      setState('restart')\r\n      break\r\n    case 'chooseCoin':\r\n      chooseCoin(data.coins, data.twoWayMode)\r\n      break\r\n    case 'smsVerification':\r\n      smsVerification(data.threshold)\r\n      break\r\n    case 'permission_id':\r\n      idVerification()\r\n      break\r\n    case 'permission_face_photo':\r\n      facephotoPermission()\r\n      break\r\n    case 'usSsnPermission':\r\n      usSsnPermission()\r\n      break\r\n    case 'blockedCustomer':\r\n      blockedCustomer()\r\n      break\r\n    case 'insertPromoCode':\r\n      promoKeyboard.activate()\r\n      setState('insert_promo_code')\r\n      break\r\n    case 'invalidPromoCode':\r\n      setState('promo_code_not_found')\r\n      break\r\n    default:\r\n      if (data.action) setState(window.snakecase(data.action))\r\n  }\r\n}\r\n\r\nfunction facephotoPermission () {\r\n  setScreen('permission_face_photo')\r\n}\r\n\r\nfunction usSsnPermission () {\r\n  setScreen('us_ssn_permission')\r\n}\r\n\r\nfunction idVerification () {\r\n  setScreen('permission_id')\r\n}\r\n\r\nfunction smsVerification (threshold) {\r\n  console.log('sms threshold to be displayed', threshold)\r\n  setScreen('sms_verification')\r\n}\r\n\r\nfunction blockedCustomer () {\r\n  return setScreen('blocked_customer')\r\n}\r\n\r\nfunction chooseCoin (coins, twoWayMode) {\r\n  if (twoWayMode) {\r\n    $('.choose_coin_state').removeClass('choose-coin-cash-in').addClass('choose-coin-two-way')\r\n  } else {\r\n    $('.choose_coin_state').removeClass('choose-coin-two-way').addClass('choose-coin-cash-in')\r\n  }\r\n\r\n  isTwoWay = twoWayMode\r\n  setChooseCoinColors()\r\n  // setupAnimation(twoWayMode, aspectRatio800)\r\n\r\n  const defaultCoin = coins[0]\r\n\r\n  currentCryptoCode = defaultCoin.cryptoCode\r\n  currentCoin = defaultCoin\r\n  currentCoins = coins.slice(0)\r\n\r\n  setCryptoBuy(defaultCoin)\r\n  setCryptoSell(defaultCoin)\r\n\r\n  setupCoinsButtons(coins, currentCryptoCode)\r\n\r\n  setState('choose_coin')\r\n}\r\n\r\nfunction openLanguageDropdown () {\r\n  $('#language-dropdown-toggle').addClass('hide')\r\n  $('#languages').removeClass('hide')\r\n  $('#language-overlay').removeClass('hide')\r\n}\r\n\r\nfunction closeLanguageDropdown () {\r\n  $('#language-dropdown-toggle').removeClass('hide')\r\n  $('#languages').addClass('hide')\r\n  $('#language-overlay').addClass('hide')\r\n}\r\n\r\nfunction openCoinDropdown () {\r\n  $('#crypto-dropdown-toggle').addClass('hide')\r\n  $('#crypto-overlay').removeClass('hide')\r\n  $('#cryptos').removeClass('hide')\r\n}\r\n\r\nfunction closeCoinDropdown () {\r\n  $('#crypto-dropdown-toggle').removeClass('hide')\r\n  $('#crypto-overlay').addClass('hide')\r\n  $('#cryptos').addClass('hide')\r\n}\r\n\r\nfunction setupCoinsButtons () {\r\n  $('.crypto-buttons').empty()\r\n  closeCoinDropdown()\r\n\r\n  let coins = currentCoins.slice()\r\n  let dropdownCoins = []\r\n\r\n  if (coins.length === 1) return\r\n\r\n  const showMoreButton = coins.length > 4\r\n  if (showMoreButton) {\r\n    $('crypto-dropdown-toggle').removeClass('hide')\r\n    dropdownCoins = coins.slice(3)\r\n    coins = coins.slice(0, 3)\r\n  } else {\r\n    $('crypto-dropdown-toggle').addClass('hide')\r\n  }\r\n\r\n  coins.forEach(function (coin) {\r\n    const activeClass = coin.cryptoCode === currentCryptoCode ? 'choose-coin-button-active' : ''\r\n    const el = `<div class=\"choose-coin-button h4 coin-${coin.cryptoCode.toLowerCase()} ${activeClass}\" data-crypto-code=\"${coin.cryptoCode}\">\r\n      ${coin.display}\r\n      <span class=\"choose-coin-svg-wrapper\">\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"52\" height=\"8\" viewBox=\"0 0 52 8\">\r\n          <path fill=\"none\" fill-rule=\"evenodd\" stroke=\"#FFF\" stroke-linecap=\"round\" stroke-width=\"8\" d=\"M4 4h44\"/>\r\n        </svg>\r\n      </span>\r\n    </div>`\r\n    $('.crypto-buttons').append(el)\r\n  })\r\n  if (showMoreButton) {\r\n    $('.crypto-buttons').append(`\r\n      <div class=\"choose-coin-button h4\" data-more=\"true\">\r\n        <div id=\"crypto-dropdown-toggle\" data-more=\"true\">\r\n          <span class=\"js-i18n\">${locale.translate('More').fetch()}</span>\r\n          <span class=\"choose-coin-svg-wrapper\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"52\" height=\"8\" viewBox=\"0 0 52 8\">\r\n              <path fill=\"none\" fill-rule=\"evenodd\" stroke=\"#FFF\" stroke-linecap=\"round\" stroke-width=\"8\" d=\"M4 4h44\"/>\r\n            </svg>\r\n          </span>\r\n        </div>\r\n        <div id=\"cryptos\" class=\"dropdown hide\"></div>\r\n      </div>\r\n    `)\r\n    dropdownCoins.forEach(coin => {\r\n      const el = `<button class=\"h4 sapphire button small-action-button coin-${coin.cryptoCode.toLowerCase()}\"\r\n        data-crypto-code=\"${coin.cryptoCode}\">${coin.display}</button>`\r\n      $('#cryptos').append(el)\r\n    })\r\n    const el = `<button class=\"h4 sapphire button small-action-button js-i18n\" data-less=\"true\">${locale.translate('Less').fetch()}</button>`\r\n    $('#cryptos').append(el)\r\n  }\r\n}\r\n\r\nfunction setCryptoBuy (coin) {\r\n  const cashIn = $('.cash-in')\r\n  const translatedCoin = locale.translate(coin.display).fetch()\r\n  const buyStr = locale.translate('Buy<br/>%s').fetch(translatedCoin)\r\n\r\n  cashIn.html(buyStr)\r\n}\r\n\r\nfunction setCryptoSell (coin) {\r\n  const cashOut = $('.cash-out')\r\n  const translatedCoin = locale.translate(coin.display).fetch()\r\n  const sellStr = locale.translate('Sell<br/>%s').fetch(translatedCoin)\r\n\r\n  cashOut.html(sellStr)\r\n}\r\n\r\nfunction switchCoin (coin) {\r\n  const cashIn = $('.cash-in')\r\n  const cashOut = $('.cash-out')\r\n  const cryptoCode = coin.cryptoCode\r\n\r\n  if (currentCryptoCode === cryptoCode) return\r\n\r\n  $(`.coin-${currentCryptoCode.toLowerCase()}`).removeClass('choose-coin-button-active')\r\n  $(`.coin-${cryptoCode.toLowerCase()}`).addClass('choose-coin-button-active')\r\n  currentCryptoCode = cryptoCode\r\n  currentCoin = coin\r\n\r\n  cashIn.addClass('crypto-switch')\r\n  setTimeout(() => setCryptoBuy(coin), 100)\r\n  setTimeout(() => cashIn.removeClass('crypto-switch'), 1000)\r\n\r\n  setTimeout(() => {\r\n    cashOut.addClass('crypto-switch')\r\n    setTimeout(() => setCryptoSell(coin), 100)\r\n    setTimeout(() => cashOut.removeClass('crypto-switch'), 1000)\r\n  }, 80)\r\n\r\n  const selectedIndex = currentCoins.indexOf(currentCoins.find(it => it.cryptoCode === cryptoCode)) \r\n  if (currentCoins.length > 4 && selectedIndex > 2) {\r\n    currentCoins.splice(2, 0, currentCoins.splice(selectedIndex, 1)[0])\r\n  }\r\n\r\n  setupCoinsButtons()\r\n}\r\n\r\n$(document).ready(function () {\r\n  const attachFastClick = Origami.fastclick\r\n  attachFastClick(document.body)\r\n\r\n  window.addEventListener('resize', () => {\r\n    calculateAspectRatio()\r\n    setChooseCoinColors()\r\n  })\r\n\r\n  // Matt's anti-drag hack\r\n  window.onclick =\r\n    window.oncontextmenu =\r\n      window.onmousedown =\r\n        window.onmousemove =\r\n          window.onmouseup =\r\n            function () { return false }\r\n\r\n  BigNumber.config({ROUNDING_MODE: BigNumber.ROUND_HALF_EVEN})\r\n\r\n  wifiKeyboard = new Keyboard('wifi-keyboard').init()\r\n\r\n  promoKeyboard = new Keyboard('promo-keyboard').init(function () {\r\n    if (currentState !== 'insert_promo_code') return\r\n    buttonPressed('cancelPromoCode')\r\n  })\r\n\r\n  usSsnKeypad = new Keypad('us-ssn-keypad', {type: 'usSsn'}, function (result) {\r\n    if (currentState !== 'register_us_ssn') return\r\n    buttonPressed('usSsn', result)\r\n  })\r\n\r\n  phoneKeypad = new Keypad('phone-keypad', {type: 'phoneNumber', country: 'US'}, function (result) {\r\n    if (currentState !== 'register_phone') return\r\n    buttonPressed('phoneNumber', result)\r\n  })\r\n\r\n  securityKeypad = new Keypad('security-keypad', {type: 'code'}, function (result) {\r\n    if (currentState !== 'security_code') return\r\n    buttonPressed('securityCode', result)\r\n  })\r\n\r\n  if (DEBUG_MODE !== 'demo') {\r\n    setupWebview();\r\n    // connect();\r\n    // setInterval(verifyConnection, 1000)\r\n  }\r\n\r\n  initTranslatePage()\r\n\r\n  var wifiNetworkButtons = document.getElementById('networks')\r\n  touchEvent(wifiNetworkButtons, function (e) {\r\n    var target = $(e.target)\r\n    if (target.attr('id') === 'more-networks') {\r\n      moreNetworks()\r\n    } else {\r\n      var networkButton = target.closest('.wifi-network-button')\r\n      $('#networks > .active').removeClass('active')\r\n      networkButton.addClass('active')\r\n      window.setTimeout(function () { networkButton.removeClass('active') }, 1000)\r\n      var ssidEl = networkButton.find('.ssid')\r\n      var ssid = ssidEl.data('ssid')\r\n      if (ssid) {\r\n        var displaySsid = ssidEl.text()\r\n        var rawSsid = ssidEl.data('raw-ssid')\r\n        buttonPressed('wifiSelect',\r\n          {ssid: ssid, rawSsid: rawSsid, displaySsid: displaySsid})\r\n      }\r\n    }\r\n  })\r\n\r\n  var wifiConnectButton = document.getElementById('wifiConnect')\r\n  touchEvent(wifiConnectButton, function () {\r\n    var wifiConnectButtonJ = $(wifiConnectButton)\r\n    wifiConnectButtonJ.addClass('active')\r\n    window.setTimeout(function () { wifiConnectButtonJ.removeClass('active') }, 500)\r\n    var pass = $('#wifi-keyboard input.passphrase').data('content')\r\n    var ssid = $('#js-i18n-wifi-for-ssid').data('ssid')\r\n    var rawSsid = $('#js-i18n-wifi-for-ssid').data('raw-ssid')\r\n    buttonPressed('wifiConnect', {pass: pass, ssid: ssid, rawSsid: rawSsid})\r\n  })\r\n\r\n  var sendCoinsButton = document.getElementById('send-coins')\r\n  var sendCoinsButton2 = document.getElementById('send-only-send-coins')\r\n  touchEvent(sendCoinsButton, function () {\r\n    setState('sending_coins')\r\n    buttonPressed('sendCoins')\r\n  })\r\n\r\n  touchEvent(sendCoinsButton2, function () {\r\n    setState('sending_coins')\r\n    buttonPressed('sendCoins')\r\n  })\r\n\r\n  const blockedCustomerOk = document.getElementById('blocked-customer-ok')\r\n  touchEvent(blockedCustomerOk, function () {\r\n    buttonPressed('blockedCustomerOk')\r\n  })\r\n  var insertBillCancelButton = document.getElementById('insertBillCancel')\r\n  touchImmediateEvent(insertBillCancelButton, function () {\r\n    setBuyerAddress(null)\r\n    buttonPressed('cancelInsertBill')\r\n  })\r\n\r\n  setupImmediateButton('wifiPassCancel', 'cancelWifiPass')\r\n  setupImmediateButton('scanCancel', 'cancelScan')\r\n  setupImmediateButton('completed_viewport', 'completed')\r\n  setupImmediateButton('withdraw_failure_viewport', 'completed')\r\n  setupImmediateButton('fiat_receipt_viewport', 'completed')\r\n  setupImmediateButton('fiat_complete_viewport', 'completed')\r\n  setupImmediateButton('chooseFiatCancel', 'chooseFiatCancel')\r\n  setupImmediateButton('depositCancel', 'depositCancel')\r\n  setupImmediateButton('printer-scan-cancel', 'cancelScan')\r\n\r\n  setupButton('printer-back-to-home', 'idle')\r\n  setupButton('printer-print-again', 'printAgain')\r\n  setupButton('printer-print-again2', 'printAgain')\r\n  setupButton('printer-scan-again', 'printerScanAgain')\r\n\r\n  setupButton('insert-first-bill-promo-button', 'insertPromoCode')\r\n  setupButton('choose-fiat-promo-button', 'insertPromoCode')\r\n\r\n  var promoCodeCancelButton = document.getElementById('promo-code-cancel')\r\n  touchImmediateEvent(promoCodeCancelButton, function () {\r\n    promoKeyboard.deactivate.bind(promoKeyboard)\r\n    buttonPressed('cancelPromoCode')\r\n  })\r\n\r\n  var submitCodeButton = document.getElementById('submit-promo-code')\r\n  touchEvent(submitCodeButton, function () {\r\n    promoKeyboard.deactivate.bind(promoKeyboard)\r\n    var code = $('.promo-code-input').data('content')\r\n    buttonPressed('submitPromoCode', { input: code })\r\n  })\r\n\r\n  setupButton('submit-promo-code', 'submitPromoCode', {\r\n    input: $('.promo-code-input').data('content')\r\n  })\r\n  setupButton('promo-code-try-again', 'insertPromoCode')\r\n  setupButton('promo-code-continue', 'cancelPromoCode')\r\n\r\n  setupButton('initialize', 'initialize')\r\n  // setupButton('test-mode', 'testMode')\r\n  setupButton('pairing-scan', 'pairingScan')\r\n  setupButton('pairing-scan-cancel', 'pairingScanCancel')\r\n  setupButton('pairing-error-ok', 'pairingErrorOk')\r\n  setupButton('cash-out-button', 'cashOut')\r\n\r\n  setupImmediateButton('scan-id-cancel', 'idDataActionCancel');\r\n  setupImmediateButton('scan-photo-cancel', 'idPhotoActionCancel');\r\n  setupImmediateButton('us-ssn-cancel', 'cancelUsSsn',\r\n    usSsnKeypad.deactivate.bind(usSsnKeypad))\r\n  setupImmediateButton('phone-number-cancel', 'cancelPhoneNumber',\r\n    phoneKeypad.deactivate.bind(phoneKeypad))\r\n  setupImmediateButton('security-code-cancel', 'cancelSecurityCode',\r\n    securityKeypad.deactivate.bind(securityKeypad))\r\n  setupButton('id-verification-failed-ok', 'idVerificationFailedOk')\r\n  setupButton('id-scan-failed-try-again', 'idCodeFailedRetry')\r\n  setupButton('id-scan-failed-cancel', 'idVerificationFailedOk')\r\n  setupButton('id-code-failed-retry', 'idCodeFailedRetry')\r\n  setupButton('id-code-failed-cancel', 'bye')\r\n  setupButton('id-verification-error-ok', 'idVerificationErrorOk')\r\n  setupButton('photo-scan-failed-retry', 'retryPhotoScan')\r\n  setupButton('photo-scan-failed-cancel', 'photoScanVerificationCancel')\r\n  setupButton('photo-verification-failed-ok', 'cancelIdScan')\r\n  setupButton('invalid-address-try-again', 'invalidAddressTryAgain')\r\n  setupButton('address-reuse-start-over', 'idle')\r\n  setupButton('suspicious-address-start-over', 'idle')\r\n\r\n  setupButton('sanctions-failure-ok', 'idle')\r\n  setupButton('limit-reached-ok', 'idle')\r\n  setupButton('hard-limit-reached-ok', 'idle')\r\n  setupButton('deposit-timeout-sent-yes', 'depositTimeout')\r\n  setupButton('deposit-timeout-sent-no', 'depositTimeoutNotSent')\r\n  setupButton('out-of-cash-ok', 'idle')\r\n\r\n  setupButton('bad-phone-number-ok', 'badPhoneNumberOk')\r\n  setupButton('bad-security-code-ok', 'badSecurityCodeOk')\r\n  setupButton('max-phone-retries-ok', 'maxPhoneRetriesOk')\r\n  setupButton('redeem-later-ok', 'idle')\r\n  setupButton('pre-receipt-ok', 'fiatReceipt')\r\n  setupButton('fiat-error-ok', 'idle')\r\n  setupButton('network-down-ok', 'idle')\r\n  setupButton('fiat-transaction-error-ok', 'fiatReceipt')\r\n\r\n  setupButton('unknown-phone-number-ok', 'idle')\r\n  setupButton('unconfirmed-deposit-ok', 'idle')\r\n  setupButton('tx-not-seen-ok', 'idle')\r\n  setupButton('wrong-dispenser-currency-ok', 'idle')\r\n\r\n  setupButton('terms-ok', 'termsAccepted')\r\n  setupButton('terms-ko', 'idle')\r\n\r\n  calculateAspectRatio()\r\n\r\n  const cryptoButtons = document.getElementById('crypto-buttons')\r\n  touchEvent(cryptoButtons, event => {\r\n    let el = $(event.target)\r\n    if (el.is('path') || el.is('svg') || el.is('span')) {\r\n      el = el.closest('div')\r\n    }\r\n\r\n    if (el.data('more')) {\r\n      openCoinDropdown()\r\n      return\r\n    }\r\n\r\n    if (el.data('less')) {\r\n      closeCoinDropdown()\r\n      return\r\n    }\r\n\r\n    const coin = { cryptoCode: el.data('cryptoCode'), display: el.text() }\r\n    if (!coin.cryptoCode) return\r\n    switchCoin(coin)\r\n  })\r\n\r\n  var areYouSureCancel = document.getElementById('are-you-sure-cancel-transaction')\r\n  touchEvent(areYouSureCancel, () => buttonPressed('cancelTransaction', previousState))\r\n\r\n  var areYouSureContinue = document.getElementById('are-you-sure-continue-transaction')\r\n  touchEvent(areYouSureContinue, () => buttonPressed('continueTransaction', previousState))\r\n\r\n  var coinRedeem = document.getElementById('coin-redeem-button')\r\n  touchEvent(coinRedeem, () => {\r\n    setDirection('cashOut')\r\n    buttonPressed('redeem')\r\n  })\r\n\r\n  setupButton('facephoto-scan-failed-retry', 'retryFacephoto')\r\n  setupButton('id-start-verification', 'permissionIdCompliance')\r\n  setupButton('sms-start-verification', 'permissionSmsCompliance')\r\n  setupButton('ready-to-scan-id-card-photo', 'scanIdCardPhoto')\r\n  setupButton('facephoto-permission-yes', 'permissionPhotoCompliance')\r\n  setupButton('us-ssn-permission-yes', 'permissionUsSsnCompliance')\r\n\r\n  setupButton('send-coins-id', 'finishBeforeSms')\r\n  setupButton('send-coins-id-2', 'finishBeforeSms')\r\n  setupButton('send-coins-sms', 'finishBeforeSms')\r\n  setupButton('send-coins-sms-2', 'finishBeforeSms')\r\n\r\n  setupButton('facephoto-permission-no', 'finishBeforeSms')\r\n  setupButton('us-ssn-permission-no', 'finishBeforeSms')\r\n  setupButton('us-ssn-cancel', 'finishBeforeSms')\r\n  setupButton('facephoto-scan-failed-cancel', 'finishBeforeSms')\r\n  setupButton('facephoto-scan-failed-cancel2', 'finishBeforeSms')\r\n\r\n  touchEvent(document.getElementById('change-language-section'), () => {\r\n    if (_primaryLocales.length === 2) {\r\n      setLocale(otherLocale())\r\n      setCryptoBuy(currentCoin)\r\n      setCryptoSell(currentCoin)\r\n      return\r\n    }\r\n    openLanguageDropdown()\r\n  })\r\n\r\n  const cashInBox = document.getElementById('cash-in-box')\r\n  touchEvent(cashInBox, () => {\r\n    buttonPressed('start', { cryptoCode: currentCryptoCode, direction: 'cashIn' })\r\n  })\r\n\r\n  const cashOutBox = document.getElementById('cash-out-box')\r\n  touchEvent(cashOutBox, () => {\r\n    buttonPressed('start', { cryptoCode: currentCryptoCode, direction: 'cashOut' })\r\n  })\r\n\r\n  var lastTouch = null\r\n\r\n  var languageOverlay = document.getElementById('language-overlay')\r\n  touchEvent(languageOverlay, function (e) {\r\n    closeLanguageDropdown()\r\n  })\r\n\r\n  var cryptoOverlay = document.getElementById('crypto-overlay')\r\n  touchEvent(cryptoOverlay, function (e) {\r\n    closeCoinDropdown()\r\n  })\r\n\r\n  var languageButtons = document.getElementById('languages')\r\n  touchEvent(languageButtons, function (e) {\r\n    var languageButtonJ = $(e.target).closest('button')\r\n    if (languageButtonJ.length === 0) return\r\n    var newLocale = languageButtonJ.attr('data-locale')\r\n\r\n    if (!newLocale) {\r\n      closeLanguageDropdown()\r\n      return\r\n    }\r\n\r\n    setLocale(newLocale)\r\n    setCryptoBuy(currentCoin)\r\n    setCryptoSell(currentCoin)\r\n    closeLanguageDropdown()\r\n  })\r\n\r\n  var fiatButtons = document.getElementById('js-fiat-buttons')\r\n  touchImmediateEvent(fiatButtons, function (e) {\r\n    var now = Date.now()\r\n    if (lastTouch && now - lastTouch < 100) return\r\n    lastTouch = now\r\n    var cashButtonJ = $(e.target).closest('.cash-button')\r\n    if (cashButtonJ.length === 0) return\r\n    if (cashButtonJ.hasClass('disabled')) return\r\n    if (cashButtonJ.hasClass('clear')) return buttonPressed('clearFiat')\r\n    var denominationIndex = cashButtonJ.attr('data-denomination-index')\r\n    var denominationRec = cassettes[denominationIndex]\r\n    buttonPressed('fiatButton', {denomination: denominationRec.denomination})\r\n  })\r\n\r\n  initDebug()\r\n})\r\n\r\nfunction targetButton (element) {\r\n  var classList = element.classList || []\r\n  var special = classList.contains('button') ||\r\n    classList.contains('circle-button') ||\r\n    classList.contains('wifi-network-button') ||\r\n    classList.contains('square-button')\r\n  if (special) { return element }\r\n  return targetButton(element.parentNode)\r\n}\r\n\r\nfunction touchEvent (element, callback) {\r\n  function handler (e) {\r\n    var target = targetButton(e.target)\r\n\r\n    target.classList.add('active')\r\n\r\n    // Wait for transition to finish\r\n    setTimeout(function () {\r\n      target.classList.remove('active')\r\n    }, 300)\r\n\r\n    setTimeout(function () {\r\n      callback(e)\r\n    }, 200)\r\n\r\n    e.stopPropagation()\r\n    e.preventDefault()\r\n  }\r\n\r\n  if (shouldEnableTouch()) {\r\n    element.addEventListener('touchend', handler)\r\n  }\r\n  element.addEventListener('mouseup', handler)\r\n}\r\n\r\nfunction touchImmediateEvent (element, callback) {\r\n  function handler (e) {\r\n    callback(e)\r\n    e.stopPropagation()\r\n    e.preventDefault()\r\n  }\r\n  if (shouldEnableTouch()) {\r\n    element.addEventListener('touchend', handler)\r\n  }\r\n  element.addEventListener('mouseup', handler)\r\n}\r\n\r\nfunction setupImmediateButton (buttonClass, buttonAction, callback) {\r\n  var button = document.getElementById(buttonClass)\r\n  touchImmediateEvent(button, function () {\r\n    if (callback) callback()\r\n    buttonPressed(buttonAction)\r\n  })\r\n}\r\n\r\nfunction setupButton (buttonClass, buttonAction, actionData) {\r\n  var button = document.getElementById(buttonClass)\r\n  touchEvent(button, function () {\r\n    buttonPressed(buttonAction, actionData)\r\n  })\r\n}\r\n\r\nfunction setScreen (newScreen, oldScreen) {\r\n  console.log(\"Set New Screen\");\r\n  console.log(newScreen);\r\n\r\n  console.log(\"Set Old Screen\");\r\n  console.log(oldScreen);\r\n\r\n  if (newScreen === oldScreen) return\r\n\r\n  if (newScreen === 'insert_bills') {\r\n    $('.js-processing-bill').html(locale.translate('Lamassu Cryptomat').fetch())\r\n    $('.bill img').css({'-webkit-transform': 'none', top: 0, left: 0})\r\n  }\r\n\r\n  var newView = $('.' + newScreen + '_state')\r\n\r\n  console.log(\"New View\");\r\n  console.log(newView);\r\n\r\n  if (newView.length !== 1) console.log('FATAL: ' + newView.length + ' screens found of class ' + newScreen + '_state')\r\n\r\n  $('.viewport').removeClass('viewport-active')\r\n  newView.addClass('viewport-active')\r\n\r\n}\r\n\r\nfunction setState (state, delay) {\r\n  console.log(\"In Set State\");\r\n  console.log(\"New State\");\r\n  console.log(state);\r\n  console.log(\"Current State\")\r\n  console.log(currentState);\r\n\r\n  if (state === currentState) return\r\n\r\n    console.log(\"Forwards\");\r\n\r\n  if (currentState === 'terms_screen') {\r\n    clearTermsConditionsTimeout()\r\n  }\r\n\r\n  previousState = currentState\r\n  currentState = state\r\n\r\n  wifiKeyboard.reset()\r\n  promoKeyboard.reset()\r\n\r\n  if (state === 'idle') {\r\n    $('.qr-code').empty()\r\n    $('.qr-code-deposit').empty()\r\n  }\r\n\r\n  if (delay) {\r\n    window.setTimeout(function () {\r\n      setScreen(currentState, previousState)\r\n    }, delay)\r\n  } else setScreen(currentState, previousState)\r\n}\r\n\r\nfunction revertScreen () { setScreen(currentState) }\r\n\r\nfunction setWifiList (recs, requestedPage) {\r\n  var networks = $('#networks')\r\n  if (!recs) recs = networks.data('recs')\r\n  var page = requestedPage || networks.data('page') || 0\r\n  var offset = page * 4\r\n  if (offset > recs.length - 1) {\r\n    offset = 0\r\n    page = 0\r\n  }\r\n  $('#more-networks').css({'display': 'none'})\r\n  networks.empty()\r\n  networks.data('page', page)\r\n  networks.data('recs', recs)\r\n  var remainingCount = recs.length - offset\r\n  var len = Math.min(remainingCount, 4)\r\n  for (var i = 0; i < len; i++) {\r\n    var rec = recs[i + offset]\r\n    var bars = Math.floor(rec.strength * 4) + 1\r\n    var html = '<div class=\"wifi-network-button filled-action-button tl2\">' +\r\n    '<span class=\"ssid\" data-raw-ssid=\"' + rec.rawSsid + '\" data-ssid=\"' +\r\n      rec.ssid + '\">' + rec.displaySsid +\r\n    '</span>' + '<div class=\"wifiicon-wrapper\"><img src=\"images/wifiicon/' + bars + '.svg\"/></div></div>'\r\n    networks.append(html)\r\n  }\r\n\r\n  var moreTxt = locale.translate('MORE').fetch()\r\n  var button = '<span display=\"inline-block\" id=\"more-networks\" class=\"button filled-action-button tl2\">' + moreTxt + '</span>'\r\n  if (recs.length > 4) {\r\n    networks.append(button)\r\n  }\r\n}\r\n\r\nfunction setUpDirectionElement (element, direction) {\r\n  if (direction === 'cashOut') {\r\n    element.removeClass('cash-in-color')\r\n    element.addClass('cash-out-color')\r\n  } else {\r\n    element.addClass('cash-in-color')\r\n    element.removeClass('cash-out-color')\r\n  }\r\n}\r\n\r\nfunction setOperatorInfo (operator) {\r\n  if (!operator || !operator.active) {\r\n    $('.contacts, .contacts-compact').addClass('hide')\r\n  } else {\r\n    $('.contacts, .contacts-compact').removeClass('hide')\r\n    $('.operator-name').text(operator.name)\r\n    $('.operator-email').text(operator.email)\r\n    $('.operator-phone').text(operator.phone)\r\n  }\r\n}\r\n\r\nfunction setHardLimit(limits) {\r\n  const component = $('#hard-limit-hours')\r\n\r\n  if (limits.hardLimitWeeks >= 1) {\r\n    return component.text(locale.translate('Please come back in %s weeks').fetch(limits.hardLimitWeeks))\r\n  }\r\n\r\n  if (limits.hardLimitDays >= 1) {\r\n    return component.text(locale.translate('Please come back in %s days and %s hours').fetch(limits.hardLimitDays, limits.hardLimitHours))\r\n  }\r\n\r\n  component.text(locale.translate('Please come back in %s hours').fetch(limits.hardLimitHours))\r\n}\r\n\r\nfunction setCryptomatModel (model) {\r\n  cryptomatModel = model\r\n  const versions = ['sintra', 'douro', 'gaia']\r\n  const body = $('body')\r\n\r\n  versions.forEach(it => body.removeClass(it))\r\n  $('body').addClass(model.startsWith('douro') ? 'douro' : model)\r\n}\r\n\r\nfunction setDirection (direction) {\r\n  let states = [\r\n    $('.scan_id_photo_state'),\r\n    $('.scan_manual_id_photo_state'),\r\n    $('.scan_id_data_state'),\r\n    $('.security_code_state'),\r\n    $('.register_us_ssn_state'),\r\n    $('.us_ssn_permission_state'),\r\n    $('.register_phone_state'),\r\n    $('.terms_screen_state'),\r\n    $('.verifying_id_photo_state'),\r\n    $('.verifying_face_photo_state'),\r\n    $('.verifying_id_data_state'),\r\n    $('.permission_id_state'),\r\n    $('.sms_verification_state'),\r\n    $('.bad_phone_number_state'),\r\n    $('.bad_security_code_state'),\r\n    $('.max_phone_retries_state'),\r\n    $('.failed_permission_id_state'),\r\n    $('.failed_verifying_id_photo_state'),\r\n    $('.blocked_customer_state'),\r\n    $('.fiat_error_state'),\r\n    $('.fiat_transaction_error_state'),\r\n    $('.failed_scan_id_data_state'),\r\n    $('.sanctions_failure_state'),\r\n    $('.error_permission_id_state'),\r\n    $('.scan_face_photo_state'),\r\n    $('.retry_scan_face_photo_state'),\r\n    $('.permission_face_photo_state'),\r\n    $('.failed_scan_face_photo_state'),\r\n    $('.hard_limit_reached_state'),\r\n    $('.failed_scan_id_photo_state'),\r\n    $('.retry_permission_id_state'),\r\n    $('.waiting_state'),\r\n    $('.insert_promo_code_state'),\r\n    $('.promo_code_not_found_state')\r\n  ]\r\n  states.forEach(it => {\r\n    setUpDirectionElement(it, direction)\r\n  })\r\n}\r\n\r\n/**\r\n *\r\n * @param {Object} data\r\n * @param {boolean} data.active\r\n * @param {String} data.title\r\n * @param {String} data.text\r\n * @param {String} data.accept\r\n * @param {String} data.cancel\r\n */\r\nfunction setTermsScreen (data) {\r\n  const $screen = $('.terms_screen_state')\r\n  $screen.find('.js-terms-title').html(data.title)\r\n  startPage(data.text)\r\n  $screen.find('.js-terms-accept-button').html(data.accept)\r\n  $screen.find('.js-terms-cancel-button').html(data.cancel)\r\n  setTermsConditionsTimeout()\r\n}\r\n\r\nfunction clearTermsConditionsTimeout () {\r\n  clearTimeout(termsConditionsTimeout)\r\n}\r\n\r\nfunction setTermsConditionsTimeout () {\r\n  termsConditionsTimeout = setTimeout(function () {\r\n    if (currentState === 'terms_screen') {\r\n      buttonPressed('idle')\r\n    }\r\n  }, T_C_TIMEOUT)\r\n}\r\n\r\nfunction resetTermsConditionsTimeout () {\r\n  clearTermsConditionsTimeout()\r\n  setTermsConditionsTimeout()\r\n}\r\n\r\n// click page up button\r\nfunction scrollUp () {\r\n  resetTermsConditionsTimeout()\r\n  const div = document.getElementById('js-terms-text-div')\r\n  if (currentPage !== 0) {\r\n    currentPage -= 1\r\n    updateButtonStyles()\r\n    updatePageCounter()\r\n    div.scrollTo(0, currentPage * scrollSize)\r\n  }\r\n}\r\n\r\n// start page\r\nfunction startPage (text) {\r\n  const $screen = $('.terms_screen_state')\r\n  $screen.find('.js-terms-text').html(text)\r\n  currentPage = 0\r\n  totalPages = 0\r\n  setTimeout(function () {\r\n    const div = document.getElementById('js-terms-text-div')\r\n    textHeightQuantity = document.getElementById('js-terms-text').offsetHeight\r\n    scrollSize = div.offsetHeight - 40\r\n    updateButtonStyles()\r\n    if (textHeightQuantity <= div.offsetHeight) {\r\n      document.getElementById('actions-scroll').style.display = 'none'\r\n    } else {\r\n      div.scrollTo(0, 0)\r\n      totalPages = Math.ceil(textHeightQuantity / scrollSize)\r\n      updatePageCounter()\r\n    }\r\n  }, 100)\r\n}\r\n\r\nfunction updatePageCounter () {\r\n  document.getElementById('terms-page-counter').textContent = `${currentPage + 1}/${totalPages}`\r\n}\r\n\r\n// click page up button\r\nfunction scrollDown () {\r\n  resetTermsConditionsTimeout()\r\n  const div = document.getElementById('js-terms-text-div')\r\n  if (!(currentPage * scrollSize + scrollSize > textHeightQuantity && currentPage !== 0)) {\r\n    currentPage += 1\r\n    updateButtonStyles()\r\n    updatePageCounter()\r\n    div.scrollTo(0, currentPage * scrollSize)\r\n  }\r\n}\r\n\r\nfunction updateButtonStyles () {\r\n  textHeightQuantity = document.getElementById('js-terms-text').offsetHeight\r\n  const buttonDown = document.getElementById('scroll-down')\r\n  const buttonUp = document.getElementById('scroll-up')\r\n  if (currentPage === 0) {\r\n    buttonUp.disabled = true\r\n  } else {\r\n    buttonUp.disabled = false\r\n  }\r\n\r\n  if (currentPage * scrollSize + scrollSize > textHeightQuantity && currentPage !== 0) {\r\n    buttonDown.disabled = true\r\n  } else {\r\n    buttonDown.disabled = false\r\n  }\r\n}\r\n\r\nfunction moreNetworks () {\r\n  var networks = $('#networks')\r\n  var page = networks.data('page')\r\n  setWifiList(null, page + 1)\r\n}\r\n\r\nfunction setWifiSsid (data) {\r\n  $('#js-i18n-wifi-for-ssid').data('ssid', data.ssid)\r\n  $('#js-i18n-wifi-for-ssid').data('raw-ssid', data.rawSsid)\r\n  t('wifi-for-ssid', locale.translate('for %s')\r\n    .fetch('<strong>' + data.ssid + '</strong>'))\r\n  t('wifi-connect', locale.translate(\"You're connecting to the WiFi network %s\")\r\n    .fetch('<strong>' + data.ssid + '</strong>'))\r\n}\r\n\r\nfunction setLocaleInfo (data) {\r\n  phoneKeypad.setCountry(data.country)\r\n  setPrimaryLocales(data.primaryLocales)\r\n  setLocale(data.primaryLocale)\r\n}\r\n\r\nfunction otherLanguageName () {\r\n  const lang = lookupLocaleNames(otherLocale())\r\n  return lang && lang.nativeName\r\n}\r\n\r\nfunction otherLocale () {\r\n  return _primaryLocales.find(c => c !== localeCode)\r\n}\r\n\r\nfunction setLocale (data) {\r\n  if (!data || data === localeCode) return\r\n  localeCode = data\r\n  jsLocaleCode = data\r\n  var lang = localeCode.split('-')[0]\r\n\r\n  if (jsLocaleCode === 'fr-QC') jsLocaleCode = 'fr-CA'\r\n\r\n  var isArabic = jsLocaleCode.indexOf('ar-') === 0\r\n  var isHebrew = jsLocaleCode.indexOf('he-') === 0\r\n  isRTL = isArabic || isHebrew\r\n\r\n  setChooseCoinColors()\r\n  // setupAnimation(isTwoWay, aspectRatio800)\r\n\r\n  if (isRTL) {\r\n    $('body').addClass('i18n-rtl')\r\n  } else {\r\n    $('body').removeClass('i18n-rtl')\r\n  }\r\n\r\n  if (isArabic) {\r\n    $('body').addClass('i18n-ar')\r\n  } else {\r\n    $('body').removeClass('i18n-ar')\r\n  }\r\n\r\n  if (isHebrew) {\r\n    $('body').addClass('i18n-he')\r\n  } else {\r\n    $('body').removeClass('i18n-he')\r\n  }\r\n\r\n  if (MUSEO.indexOf(lang) !== -1) $('body').addClass('museo')\r\n  else $('body').removeClass('museo')\r\n\r\n  locale = loadI18n(localeCode)\r\n  try { translatePage() } catch (ex) {}\r\n\r\n  $('.js-two-language').html(otherLanguageName())\r\n\r\n  if (lastRates) setExchangeRate(lastRates)\r\n}\r\n\r\nfunction setChooseCoinColors () {\r\n  var elem = $('#bg-to-show > img')\r\n  let img = `images/background/${isTwoWay ? '2way' : '1way'}-${aspectRatio}${isRTL ? '-rtl' : ''}.svg`\r\n  if (img !== elem.attr('src')) {\r\n    elem.attr('src', img)\r\n  }\r\n\r\n  if (isTwoWay) {\r\n    $('.choose_coin_state .change-language').removeClass('cash-in-color').addClass('cash-out-color')\r\n  } else {\r\n    $('.choose_coin_state .change-language').removeClass('cash-out-color').addClass('cash-in-color')\r\n  }\r\n}\r\n\r\nfunction areArraysEqual (arr1, arr2) {\r\n  if (arr1.length !== arr2.length) return false\r\n  for (var i = 0; i < arr1.length; i++) {\r\n    if (arr1[i] !== arr2[i]) return false\r\n  }\r\n  return true\r\n}\r\n\r\nfunction lookupLocaleNames (locale) {\r\n  if (!locale) return\r\n  var langMap = window.languageMappingList\r\n  var language = locale.split('-')[0]\r\n  var localeNames = langMap[language]\r\n  return localeNames || langMap[locale]\r\n}\r\n\r\nfunction setPrimaryLocales (primaryLocales) {\r\n  if (areArraysEqual(primaryLocales, _primaryLocales)) return\r\n  _primaryLocales = primaryLocales\r\n\r\n  var languages = $('#languages')\r\n  closeLanguageDropdown()\r\n  languages.empty()\r\n  var sortedPrimaryLocales = primaryLocales.filter(lookupLocaleNames).sort(function (a, b) {\r\n    var langA = lookupLocaleNames(a)\r\n    var langB = lookupLocaleNames(b)\r\n    return langA.englishName.localeCompare(langB.englishName)\r\n  })\r\n\r\n  languages.append(`<button class=\"square-button small-action-button tl2\">Languages</button>`)\r\n  for (var i = 0; i < sortedPrimaryLocales.length; i++) {\r\n    var l = sortedPrimaryLocales[i]\r\n    var lang = lookupLocaleNames(l)\r\n    var name = lang.nativeName || lang.englishName\r\n    var div = `<button class=\"square-button small-action-button tl2\" data-locale=\"${l}\">${name}</button>`\r\n    languages.append(div)\r\n  }\r\n\r\n  $('.js-two-language').html(otherLanguageName())\r\n\r\n  $('.js-menu-language').toggleClass('hide', sortedPrimaryLocales.length <= 1)\r\n  $('.js-multi-language').toggleClass('hide', sortedPrimaryLocales.length === 2)\r\n  $('.js-two-language').toggleClass('hide', sortedPrimaryLocales.length > 2)\r\n}\r\n\r\nfunction setFiatCode (data) {\r\n  fiatCode = data\r\n  $('.js-currency').text(fiatCode)\r\n}\r\n\r\nfunction setFixedFee (_fee) {\r\n  const fee = parseFloat(_fee)\r\n\r\n  if (fee > 0) {\r\n    const fixedFee = locale.translate('Transaction Fee: %s').fetch(formatFiat(fee, 2))\r\n    $('.js-i18n-fixed-fee').html(fixedFee)\r\n  } else {\r\n    $('.js-i18n-fixed-fee').html('')\r\n  }\r\n}\r\n\r\nfunction setCredit (fiat, crypto, lastBill, cryptoCode) {\r\n  var coin = coins[cryptoCode]\r\n\r\n  var scale = new BigNumber(10).pow(coin.displayScale)\r\n  var cryptoAmount = new BigNumber(crypto).div(scale).toNumber()\r\n  var cryptoDisplayCode = coin.displayCode\r\n  updateCrypto('.total-crypto-rec', cryptoAmount, cryptoDisplayCode)\r\n  $('.amount-deposited').html(locale.translate('You deposited %s').fetch(`${fiat} ${fiatCode}`))\r\n  $('.fiat .js-amount').html(fiat)\r\n\r\n  var inserted = lastBill\r\n    ? locale.translate('You inserted a %s bill').fetch(formatFiat(lastBill))\r\n    : locale.translate('Lamassu Cryptomat').fetch()\r\n\r\n  $('.js-processing-bill').html(inserted)\r\n\r\n  $('.js-send-crypto-disable').hide()\r\n  $('.js-send-crypto-enable').show()\r\n}\r\n\r\nfunction setupCassettes (_cassettes) {\r\n  cassettes = _cassettes\r\n  for (var i = 0; i < cassettes.length; i++) {\r\n    var cassette = cassettes[i]\r\n    var denomination = cassette.denomination.toLocaleString(jsLocaleCode, {\r\n      useGrouping: true,\r\n      maximumFractionDigits: 0,\r\n      minimumFractionDigits: 0\r\n    })\r\n    $('.cash-button[data-denomination-index=' + i + '] .js-denomination').text(denomination)\r\n  }\r\n}\r\n\r\nfunction updateCrypto (selector, cryptoAmount, cryptoDisplayCode) {\r\n  $(selector).find('.crypto-amount').html(formatCrypto(cryptoAmount))\r\n  $(selector).find('.crypto-units').html(cryptoDisplayCode)\r\n}\r\n\r\nfunction lookupDecimalChar (localeCode) {\r\n  var num = 1.1\r\n  var localized = num.toLocaleString(jsLocaleCode, {\r\n    useGrouping: true,\r\n    maximumFractionDigits: 1,\r\n    minimumFractionDigits: 1\r\n  })\r\n\r\n  return localized[1]\r\n}\r\n\r\nfunction splitNumber (localize, localeCode) {\r\n  var decimalChar = lookupDecimalChar(localeCode)\r\n  var split = localize.split(decimalChar)\r\n\r\n  if (split.length === 1) {\r\n    return ['<span class=\"integer\">', split[0], '</span>'].join('')\r\n  }\r\n\r\n  return [\r\n    '<span class=\"integer\">', split[0], '</span><span class=\"decimal-char\">',\r\n    decimalChar, '</span><span class=\"decimal\">', split[1], '</span>'\r\n  ].join('')\r\n}\r\n\r\nfunction formatNumber (num) {\r\n  var localized = num.toLocaleString(jsLocaleCode, {\r\n    useGrouping: true,\r\n    maximumFractionDigits: 3,\r\n    minimumFractionDigits: 3\r\n  })\r\n\r\n  return splitNumber(localized, jsLocaleCode)\r\n}\r\n\r\nfunction formatCrypto (amount) {\r\n  return formatNumber(amount)\r\n}\r\n\r\nfunction formatFiat (amount, fractionDigits) {\r\n  if (!fractionDigits) fractionDigits = 0\r\n\r\n  const localized = amount.toLocaleString(jsLocaleCode, {\r\n    useGrouping: true,\r\n    maximumFractionDigits: fractionDigits,\r\n    minimumFractionDigits: fractionDigits\r\n  })\r\n  return splitNumber(localized, jsLocaleCode) + ' ' + fiatCode\r\n}\r\n\r\nfunction setExchangeRate (_rates) {\r\n  lastRates = _rates\r\n  var cryptoCode = _rates.cryptoCode\r\n  var rates = _rates.rates\r\n\r\n  var coin = coins[cryptoCode]\r\n  var displayCode = coin.displayCode\r\n\r\n  if (rates.cashIn) {\r\n    var cryptoToFiat = new BigNumber(rates.cashIn)\r\n    var rateStr = formatFiat(cryptoToFiat.round(2).toNumber(), 2)\r\n\r\n    $('.crypto-rate-cash-in').html(`1 ${cryptoCode} = ${rateStr}`)\r\n  }\r\n\r\n  if (rates.cashOut) {\r\n    var cashOut = new BigNumber(rates.cashOut)\r\n    var cashOutCryptoToFiat = cashOut && formatFiat(cashOut.round(2).toNumber(), 2)\r\n\r\n    $('.crypto-rate-cash-out').html(`1 ${cryptoCode} = ${cashOutCryptoToFiat}`)\r\n  }\r\n\r\n  $('.js-crypto-display-units').text(displayCode)\r\n}\r\n\r\nfunction qrize (text, target, color, lightning) {\r\n  const image = document.getElementById('bolt-img')\r\n  // Hack for surf browser\r\n  const size = document.body.clientHeight * 0.36\r\n\r\n  const opts = {\r\n    crisp: true,\r\n    fill: color || 'black',\r\n    text,\r\n    size,\r\n    render: 'canvas',\r\n    rounded: 50,\r\n    quiet: 2,\r\n    mPosX: 50,\r\n    mPosY: 50,\r\n    mSize: 30,\r\n    image\r\n  }\r\n\r\n  if (lightning) {\r\n    opts.mode = 'image'\r\n  }\r\n\r\n  const el = kjua(opts)\r\n\r\n  target.empty().append(el)\r\n}\r\n\r\nfunction setTx (tx) {\r\n  const txId = tx.id\r\n  const isPaperWallet = tx.isPaperWallet\r\n  const hasBills = tx.bills && tx.bills.length > 0\r\n\r\n  if (hasBills) {\r\n    $('.js-inserted-notes').show()\r\n    $('.js-no-inserted-notes').hide()\r\n  } else {\r\n    $('.js-inserted-notes').hide()\r\n    $('.js-no-inserted-notes').show()\r\n  }\r\n\r\n  $('.js-paper-wallet').toggleClass('hide', !isPaperWallet)\r\n\r\n  setTimeout(() => {\r\n    qrize(txId, $('#cash-in-qr-code'), CASH_IN_QR_COLOR)\r\n    qrize(txId, $('#cash-in-fail-qr-code'), CASH_IN_QR_COLOR)\r\n    qrize(txId, $('#qr-code-fiat-receipt'), CASH_OUT_QR_COLOR)\r\n    qrize(txId, $('#qr-code-fiat-complete'), CASH_OUT_QR_COLOR)\r\n  }, 1000)\r\n}\r\n\r\nfunction formatAddressNoBreakLines (address) {\r\n  if (!address) return\r\n  return address.replace(/(.{4})/g, '$1 ')\r\n}\r\n\r\nfunction formatAddress (address) {\r\n  let toBr = formatAddressNoBreakLines(address)\r\n  if (!toBr) return\r\n\r\n  return toBr.replace(/((.{4} ){5})/g, '$1<br/> ')\r\n}\r\n\r\nfunction setBuyerAddress (address) {\r\n  $('.crypto-address-no-br').html(formatAddressNoBreakLines(address))\r\n  $('.crypto-address').html(formatAddress(address))\r\n}\r\n\r\nfunction setAccepting (currentAccepting) {\r\n  accepting = currentAccepting\r\n  if (accepting) {\r\n    $('.bill img').transition({x: 0, y: -303}, 1000, 'ease-in')\r\n  } else {\r\n    $('.bill img').transition({x: 0, y: 0}, 1000, 'ease-out')\r\n  }\r\n}\r\n\r\nfunction highBill (highestBill, reason) {\r\n  var reasonText = reason === 'transactionLimit'\r\n    ? locale.translate('Transaction limit reached.').fetch()\r\n    : locale.translate(\"We're a little low on crypto.\").fetch()\r\n\r\n  t('high-bill-header', reasonText)\r\n  t('highest-bill', locale.translate('Please insert %s or less.')\r\n    .fetch(formatFiat(highestBill)))\r\n  setScreen('high_bill')\r\n  window.setTimeout(revertScreen, 3000)\r\n}\r\n\r\nfunction minimumTx (lowestBill) {\r\n  t('lowest-bill', locale.translate('Minimum first bill is %s.')\r\n    .fetch(formatFiat(lowestBill)))\r\n  setScreen('minimum_tx')\r\n  window.setTimeout(revertScreen, 3000)\r\n}\r\n\r\nfunction readingBill (bill) {\r\n  $('.js-processing-bill').html(locale.translate('Processing %s ...').fetch(formatFiat(bill)))\r\n  $('.js-send-crypto-enable').hide()\r\n  $('.js-send-crypto-disable').show()\r\n}\r\n\r\nfunction sendOnly (reason) {\r\n  // TODO: sendOnly should be made into its own state on brain.js\r\n  if (currentState === 'send_only') return\r\n\r\n  const errorMessages = {\r\n    transactionLimit: locale.translate('Transaction limit reached').fetch(),\r\n    validatorError: locale.translate('Error in validation').fetch(),\r\n    lowBalance: locale.translate(\"We're out of coins!\").fetch(),\r\n    blockedCustomer: locale.translate('Transaction limit reached').fetch()\r\n  }\r\n\r\n  // If no reason provided defaults to lowBalance\r\n  const reasonText = errorMessages[reason] || errorMessages.lowBalance\r\n  $('#send-only-title').text(reasonText)\r\n\r\n  if (reason === 'blockedCustomer') {\r\n    $('.js-send-only-text').text(locale.translate(\"Due to local regulations, you've reached your transaction limit. Please contact us if you'd like to raise your limit.\").fetch())\r\n  } else {\r\n    $('.js-send-only-text').text('')\r\n  }\r\n\r\n  setState('send_only')\r\n}\r\n\r\nfunction setPartialSend (sent, total) {\r\n  $('#already-sent').text(formatFiat(sent.fiat))\r\n  $('#pending-sent').text(formatFiat(total.fiat - sent.fiat))\r\n}\r\n\r\nfunction t (id, str) {\r\n  $('#js-i18n-' + id).html(str)\r\n}\r\n\r\nfunction translateCoin (cryptoCode) {\r\n  $('.js-i18n-scan-your-address').html(locale.translate('Scan your <br/> %s address').fetch(cryptoCode))\r\n  $('.js-i18n-please-scan').html(locale.translate('Please scan the QR code <br/> to send us your %s.').fetch(cryptoCode))\r\n  $('.js-i18n-did-send-coins').html(locale.translate('Have you sent the %s yet?').fetch(cryptoCode))\r\n  $('.js-i18n-scan-address').html(locale.translate('Scan your %s address').fetch(cryptoCode))\r\n  $('.js-i18n-invalid-address').html(locale.translate('Invalid %s address').fetch(cryptoCode))\r\n\r\n  if (cryptoCode === 'ETH') {\r\n    $('.js-i18n-authorizing-note').html(locale.translate('This should take <strong>15 seconds</strong> on average.<br/>Occasionally, it will take over a minute.').fetch(cryptoCode))\r\n  }\r\n}\r\n\r\nfunction initTranslatePage () {\r\n  $('.js-i18n').each(function () {\r\n    var el = $(this)\r\n    el.data('baseTranslation', el.html().trim())\r\n  })\r\n  $('input[placeholder]').each(function () {\r\n    var el = $(this)\r\n    el.data('baseTranslation', el.attr('placeholder'))\r\n  })\r\n}\r\n\r\nfunction translatePage () {\r\n  $('.js-i18n').each(function () {\r\n    var el = $(this)\r\n    var base = el.data('baseTranslation')\r\n    el.html(locale.translate(base).fetch())\r\n  })\r\n  $('input[placeholder]').each(function () {\r\n    var el = $(this)\r\n    var base = el.data('baseTranslation')\r\n    el.attr('placeholder', locale.translate(base).fetch())\r\n  })\r\n\r\n  // Adjust send coins button\r\n  var length = $('#send-coins span').text().length\r\n  if (length > 17) $('body').addClass('i18n-long-send-coins')\r\n  else $('body').removeClass('i18n-long-send-coins')\r\n}\r\n\r\nfunction loadI18n (localeCode) {\r\n  var messages = locales[localeCode] || locales['en-US']\r\n\r\n  return new Jed({\r\n    'missing_key_callback': function () {},\r\n    'locale_data': {\r\n      'messages': messages\r\n    }\r\n  })\r\n}\r\n\r\nfunction reachFiatLimit (rec) {\r\n  var msg = null\r\n  if (rec.isEmpty) msg = locale.translate(`We're a little low, please cash out`)\r\n  else if (rec.txLimitReached) msg = locale.translate('Transaction limit reached, please cash out')\r\n\r\n  var el = $('.choose_fiat_state .limit')\r\n  if (msg) el.html(msg).show()\r\n  else el.hide()\r\n}\r\n\r\nfunction chooseFiat (data) {\r\n  fiatCredit(data)\r\n  setState('choose_fiat')\r\n}\r\n\r\nfunction manageFiatButtons (activeDenominations) {\r\n  for (var i = 0; i < cassettes.length; i++) {\r\n    var cassette = cassettes[i]\r\n    var denomination = cassette.denomination\r\n    var enabled = activeDenominations[denomination]\r\n    var button = $('.choose_fiat_state .cash-button[data-denomination-index=' + i + ']')\r\n    if (enabled) button.prop('disabled', false)\r\n    else button.prop('disabled', true)\r\n  }\r\n}\r\n\r\nfunction displayCrypto (cryptoAtoms, cryptoCode) {\r\n  var coin = coins[cryptoCode]\r\n  var scale = new BigNumber(10).pow(coin.displayScale)\r\n  var cryptoAmount = new BigNumber(cryptoAtoms).div(scale).precision(3).toNumber()\r\n  var cryptoDisplay = formatCrypto(cryptoAmount)\r\n\r\n  return cryptoDisplay\r\n}\r\n\r\nfunction BN (s) { return new BigNumber(s) }\r\n\r\nfunction fiatCredit (data) {\r\n  var tx = data.tx\r\n  var cryptoCode = tx.cryptoCode\r\n  var activeDenominations = data.activeDenominations\r\n  var coin = coins[cryptoCode]\r\n  const fiat = BN(tx.fiat)\r\n\r\n  var fiatDisplay = BN(tx.fiat).toNumber().toLocaleString(jsLocaleCode, {\r\n    useGrouping: true,\r\n    maximumFractionDigits: 0,\r\n    minimumFractionDigits: 0\r\n  })\r\n\r\n  var cryptoAtoms = BN(tx.cryptoAtoms)\r\n  var cryptoDisplay = displayCrypto(cryptoAtoms, cryptoCode)\r\n\r\n  var cryptoDisplayCode = coin.displayCode\r\n\r\n  if (cryptoAtoms.eq(0)) $('#js-i18n-choose-digital-amount').hide()\r\n  else $('#js-i18n-choose-digital-amount').show()\r\n\r\n  if (fiat.eq(0)) $('#cash-out-button').prop('disabled', true)\r\n  else $('#cash-out-button').prop('disabled', false)\r\n\r\n  manageFiatButtons(activeDenominations.activeMap)\r\n  $('.choose_fiat_state .fiat-amount').text(fiatDisplay)\r\n  t('choose-digital-amount',\r\n    locale.translate(\"You'll be sending %s %s\").fetch(cryptoDisplay, cryptoDisplayCode))\r\n\r\n  reachFiatLimit(activeDenominations)\r\n}\r\n\r\nfunction setDepositAddress (depositInfo) {\r\n  $('.deposit_state .loading').hide()\r\n  $('.deposit_state .send-notice .crypto-address').html(formatAddress(depositInfo.toAddress))\r\n  $('.deposit_state .send-notice').show()\r\n\r\n  qrize(depositInfo.depositUrl, $('#qr-code-deposit'), CASH_OUT_QR_COLOR)\r\n}\r\n\r\nfunction setVersion (version) {\r\n  $('.version-number').html(`Version: ${version}`)\r\n}\r\n\r\nfunction deposit (tx) {\r\n  var cryptoCode = tx.cryptoCode\r\n  var display = displayCrypto(tx.cryptoAtoms, cryptoCode)\r\n\r\n  $('.js-wallet-address').show()\r\n\r\n  $('.deposit_state .digital .js-amount').html(display)\r\n  $('.deposit_state .fiat .js-amount').text(tx.fiat)\r\n  $('.deposit_state .send-notice').hide()\r\n  $('#qr-code-deposit').empty()\r\n  $('.deposit_state .loading').show()\r\n  $('#qr-code-deposit').show()\r\n\r\n  setState('deposit')\r\n}\r\n\r\nfunction fiatReceipt (tx) {\r\n  var cryptoCode = tx.cryptoCode\r\n  var display = displayCrypto(tx.cryptoAtoms, cryptoCode)\r\n\r\n  $('.fiat_receipt_state .digital .js-amount').html(display)\r\n  $('.fiat_receipt_state .fiat .js-amount').text(tx.fiat)\r\n  $('.fiat_receipt_state .sent-coins .crypto-address').html(formatAddress(tx.toAddress))\r\n\r\n  setState('fiat_receipt')\r\n}\r\n\r\nfunction fiatComplete (tx) {\r\n  var cryptoCode = tx.cryptoCode\r\n  var display = displayCrypto(tx.cryptoAtoms, cryptoCode)\r\n\r\n  $('.fiat_complete_state .digital .js-amount').html(display)\r\n  $('.fiat_complete_state .fiat .js-amount').text(tx.fiat)\r\n  $('.fiat_complete_state .sent-coins .crypto-address').html(formatAddress(tx.toAddress))\r\n\r\n  setState('fiat_complete')\r\n}\r\n\r\nfunction dispenseBatch (data) {\r\n  $('.batch').css('visibility', data.of === 1 ? 'hidden' : 'visible')\r\n  $('.batch').text(`${data.current}/${data.of}`)\r\n}\r\n\r\nfunction initDebug () {\r\n  if (DEBUG_MODE === 'dev') {\r\n    $('body').css('cursor', 'default')\r\n    var style = document.createElement('style')\r\n    style.type = 'text/css'\r\n    style.innerHTML = 'button { cursor: default !important; }'\r\n    document.getElementsByTagName('head')[0].appendChild(style)\r\n\r\n    return\r\n  }\r\n\r\n  if (DEBUG_MODE === 'demo') {\r\n    setPrimaryLocales(['en-US'])\r\n    setLocale('en-US')\r\n    $('body').css('cursor', 'default')\r\n    var style = document.createElement('style')\r\n    style.type = 'text/css'\r\n    style.innerHTML = 'button { cursor: default !important; }'\r\n    document.getElementsByTagName('head')[0].appendChild(style)\r\n\r\n    if (!SCREEN) {\r\n      return chooseCoin([\r\n        {display: 'Bitcoin', cryptoCode: 'BTC'},\r\n        {display: 'Ethereum', cryptoCode: 'ETH'},\r\n        {display: 'ZCash', cryptoCode: 'ZEC'}\r\n      ], true)\r\n    }\r\n\r\n    setState(SCREEN)\r\n  }\r\n}\r\n\r\nfunction calculateAspectRatio () {\r\n  const width = $('body').width()\r\n  const height = $('body').height()\r\n\r\n  function gcd (a, b) {\r\n    return (b === 0) ? a : gcd(b, a % b)\r\n  }\r\n\r\n  const w = width\r\n  const h = height\r\n  const r = gcd(w, h)\r\n  const aspectRatioPt1 = w / r\r\n  const aspectRatioPt2 = h / r\r\n\r\n  if (aspectRatioPt1 === 8 && aspectRatioPt2 === 5) {\r\n    aspectRatio = '16:10'\r\n  } else if (aspectRatioPt1 === 16 && aspectRatioPt2 === 9) {\r\n    aspectRatio = '16:9'\r\n  } else {\r\n    aspectRatio = w < 1420 ? '16:10' : '16:9'\r\n  }\r\n}\r\n\r\nlet background = null\r\n\r\nfunction doTransition (cb) {\r\n  // TODO Disable animations for V1\r\n  let toShow = null\r\n  let toShowOver = null\r\n\r\n  if (isTwoWay) {\r\n    toShow = ['#bg-to-show']\r\n    toShowOver = ['.crypto-buttons', '.cash-in-box-wrapper']\r\n  } else {\r\n    toShow = ['#bg-to-show']\r\n    toShowOver = ['header', 'main']\r\n  }\r\n\r\n  two.start()\r\n  var tl = new TimelineMax()\r\n  tl.set('.fade-in-delay', { opacity: 0, y: +30 })\r\n    .set('.fade-in', { opacity: 0, y: +30 })\r\n    .set(toShow, { zIndex: 1 })\r\n    .set(toShowOver, { zIndex: 2 })\r\n    .to(background, 0.5, { scale: isTwoWay ? 3 : 2 })\r\n    .to('.fade-in', 0.4, {\r\n      opacity: 1,\r\n      onStart: cb,\r\n      y: 0\r\n    }, '=-0.2')\r\n    .to('.fade-in-delay', 0.4, { opacity: 1, y: 0 }, '=-0.2')\r\n    .set(background, { scale: 1 })\r\n    .set(toShow, { zIndex: -1 })\r\n    .set(toShowOver, { zIndex: 0 })\r\n  two.pause()\r\n}\r\n\r\nfunction setupAnimation (isTwoWay, isAr800) {\r\n  var elem = document.getElementById('bg-to-show')\r\n  while (elem.firstChild) {\r\n    elem.removeChild(elem.firstChild)\r\n  }\r\n  two = new Two({ fullscreen: true, type: Two.Types.svg, autostart: true }).appendTo(elem)\r\n\r\n  let elementId = `${isTwoWay ? 'two-way' : 'one-way'}-${isAr800 ? '800' : '1080'}${isRTL ? '-rtl' : ''}`\r\n  background = two.interpret(document.getElementById(elementId))\r\n  background.scale = 1\r\n}\r\n\r\nfunction shouldEnableTouch () {\r\n  const ua = navigator.userAgent\r\n  if (ua.match(/surf/ig)) return false\r\n\r\n  // ACP has chromium 34 and upboard 73\r\n  const chromiumVersion = ua.match(/chromium\\/(\\d+)/i)\r\n  const chromeVersion = ua.match(/chrome\\/(\\d+)/i)\r\n  const chromiumPlus73 = chromiumVersion && chromiumVersion[1] >= 73\r\n  const chromePlus73 = chromeVersion && chromeVersion[1] >= 73\r\n\r\n  return chromiumPlus73 || chromePlus73\r\n}\r\n\r\nfunction setAvailablePromoCodes (areThereAvailablePromoCodes) {\r\n  if (areThereAvailablePromoCodes) {\r\n    $('#insert-first-bill-code-added').hide()\r\n    $('#choose-fiat-code-added').hide()\r\n    $('#insert-first-bill-promo-button').show()\r\n    $('#choose-fiat-promo-button').show()\r\n  } else {\r\n    $('#insert-first-bill-promo-button').hide()\r\n    $('#choose-fiat-promo-button').hide()\r\n  }\r\n}\r\n\r\nfunction setCurrentDiscount (currentDiscount) {\r\n  if (currentDiscount > 0) {\r\n    const successMessage = ' ' + locale.translate('Promo code added (%s discount)').fetch(`${currentDiscount}%`)\r\n    $('#insert-first-bill-promo-button').hide()\r\n    $('#choose-fiat-promo-button').hide()\r\n    $('#insert-first-bill-code-added').html(successMessage)\r\n    $('#choose-fiat-code-added').html(successMessage)\r\n    $('#insert-first-bill-code-added').show()\r\n    $('#choose-fiat-code-added').show()\r\n  } else {\r\n    $('#insert-first-bill-promo-button').show()\r\n    $('#choose-fiat-promo-button').show()\r\n    $('#insert-first-bill-code-added').hide()\r\n    $('#choose-fiat-code-added').hide()\r\n  }\r\n}\r\n"]}